<div class="management-container">
    <!-- Header Section -->
    <div class="page-header">
        <div class="header-content">
            <div class="title-section">
                <mat-icon class="header-icon">calendar_today</mat-icon>
                <div>
                    <h1>Session & Term Management</h1>
                    <p>Manage your school's academic sessions and terms</p>
                </div>
            </div>
            <button 
                mat-flat-button 
                color="primary" 
                (click)="createNewSession()"
                [disabled]="hasActiveSession"
            >
                <mat-icon>add</mat-icon>
                New Session
            </button>
        </div>
    </div>

    <div class="loading-container" *ngIf="isLoading">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Loading sessions...</p>
    </div>

    <!-- Current Session Section -->
    <div class="current-session-section" *ngIf="!isLoading && currentSession">
        <div class="section-header">
            <h2>
                <mat-icon>star</mat-icon>
                Current Active Session
            </h2>
        </div>

        <mat-card class="session-card active-session">
            <mat-card-header>
                <mat-card-title>
                    <div class="session-title">
                        {{ currentSession.sessionName }}
                        <span class="active-badge">ACTIVE</span>
                    </div>
                </mat-card-title>
                <mat-card-subtitle>
                    {{ currentSession.startYear }} - {{ currentSession.endYear }}
                </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
                <!-- Terms Section -->
                <div class="terms-section">
                    <div class="terms-header">
                        <h3>Terms ({{ currentSession.terms.length || 0 }}/3)</h3>
                        <button 
                            mat-raised-button 
                            color="accent"
                            (click)="openCreateTermDialog(currentSession._id)"
                            [disabled]="(currentSession.terms.length || 0) >= 3"
                        >
                            <mat-icon>add</mat-icon>
                            Add Term
                        </button>
                    </div>

                    <!-- Terms Grid -->
                    <div class="terms-grid" *ngIf="currentSession.terms && currentSession.terms.length > 0">
                        <div 
                            class="term-card" 
                            *ngFor="let term of currentSession.terms"
                            [class.active-term]="term.isActive"
                            [class.needs-update]="!term.startDate || !term.endDate"
                        >
                            <div class="term-header">
                                <div class="term-name">
                                    <mat-icon>event</mat-icon>
                                    {{ term.name }} TERM
                                </div>
                                <span class="status-badge" [class.active]="term.isActive">
                                    {{ term.isActive ? 'Active' : 'Inactive' }}
                                </span>
                            </div>

                            <div class="term-dates">
                                <div *ngIf="term.startDate && term.endDate">
                                    <div class="date-item">
                                        <mat-icon>start</mat-icon>
                                        <span>{{ formatDate(term.startDate) }}</span>
                                    </div>
                                    <div class="date-item">
                                        <mat-icon>end</mat-icon>
                                        <span>{{ formatDate(term.endDate) }}</span>
                                    </div>
                                </div>

                                <div *ngIf="!term.startDate || !term.endDate" class="no-dates-message">
                                    <mat-icon>warning</mat-icon>
                                    <span>Dates not set</span>
                                </div>
                            </div>

                            <div class="term-actions">
                                <button 
                                    mat-raised-button 
                                    [color]="(!term.startDate || !term.endDate) ? 'warn' : 'primary'"
                                    (click)="openUpdateTermDialog(term)"
                                    class="update-btn"
                                >
                                    <mat-icon>{{ (!term.startDate || !term.endDate) ? 'add' : 'edit' }}</mat-icon>
                                    {{ (!term.startDate || !term.endDate) ? 'Set Dates' : 'Update Dates' }}
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="no-terms" *ngIf="!currentSession.terms || currentSession.terms.length === 0">
                        <mat-icon>event_busy</mat-icon>
                        <p>No terms created yet</p>
                        <button 
                            mat-stroked-button 
                            color="primary"
                            (click)="openCreateTermDialog(currentSession._id)"
                        >
                            Create First Term
                        </button>
                    </div>
                </div>
            </mat-card-content>

            <mat-card-actions>
            <button 
                mat-button 
                color="warn"
                (click)="closeSession(currentSession._id, currentSession.sessionName)">
                <mat-icon>lock</mat-icon>
                Close Session
            </button>
            <button mat-button (click)="viewSessionDetails(currentSession)">
                <mat-icon>visibility</mat-icon>
                View Details
            </button>
            </mat-card-actions>
        </mat-card>
    </div>

    <!-- All Sessions History -->
    <div class="sessions-history" *ngIf="!isLoading && allSessions.length > 0">
    <div class="section-header">
        <h2>
        <mat-icon>history</mat-icon>
        Sessions History
        </h2>
    </div>

    <div class="sessions-grid">
        <mat-card 
        class="session-card" 
        *ngFor="let session of allSessions"
        [class.inactive]="!session.isActive">
        <mat-card-header>
            <mat-card-title>
            {{ session.sessionName }}
            <span class="status-badge" [class.active]="session.isActive">
                {{ session.isActive ? 'Active' : 'Closed' }}
            </span>
            </mat-card-title>
            <mat-card-subtitle>
            {{ session.startYear }} - {{ session.endYear }}
            </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
            <div class="session-stats">
            <div class="stat-item">
                <mat-icon>event_note</mat-icon>
                <span>{{ session.terms.length || 0 }} Terms</span>
            </div>
            <div class="stat-item" *ngIf="session.createdAt">
                <mat-icon>schedule</mat-icon>
                <span>Created {{ formatDate(session.createdAt) }}</span>
            </div>
            </div>
        </mat-card-content>

        <mat-card-actions>
            <button mat-button (click)="viewSessionDetails(session)">
            <mat-icon>visibility</mat-icon>
            View Details
            </button>
        </mat-card-actions>
        </mat-card>
    </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading && !currentSession && allSessions.length === 0">
    <mat-icon>event_available</mat-icon>
    <h2>No Sessions Yet</h2>
    <p>Create your first academic session to get started</p>
    <button mat-flat-button color="primary" (click)="createNewSession()">
        <mat-icon>add</mat-icon>
        Create First Session
    </button>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats" *ngIf="!isLoading && currentSession">
        <mat-card class="stat-card">
            <mat-icon>calendar_today</mat-icon>
            <div class="stat-content">
                <h3>{{ allSessions.length }}</h3>
                <p>Total Sessions</p>
            </div>
        </mat-card>

        <mat-card class="stat-card">
            <mat-icon>event</mat-icon>
            <div class="stat-content">
                <h3>{{ currentSession.terms.length || 0 }}</h3>
                <p>Terms</p>
            </div>
        </mat-card>

        <mat-card class="stat-card">
            <mat-icon>check_circle</mat-icon>
            <div class="stat-content">
                <h3>{{ getActiveTermName() }}</h3>
                <p>Current Term</p>
            </div>
        </mat-card>
    </div>
</div>